import{r as E,_ as C,a as k,v as _,q as j}from"./assets/@qwik-city-plan-a1246418.mjs";import{s as P,r as D,m as O}from"./assets/entry.ssr-8d88b31e.mjs";import{getNotFound as F}from"./@qwik-city-not-found-paths.js";import{isStaticPath as z}from"./@qwik-city-static-paths.js";import{createReadStream as A}from"fs";import{join as y,basename as U,extname as $}from"path";import{fileURLToPath as L}from"url";import{Http2ServerRequest as W}from"http2";import{TextEncoderStream as G,TextDecoderStream as N,WritableStream as I,ReadableStream as M}from"stream/web";import{fetch as q,Headers as B,Request as Q,Response as X,FormData as Y}from"undici";import J from"crypto";import T from"express";import{fileURLToPath as K}from"node:url";import{join as R}from"node:path";import V from"compression";import Z from"morgan";import"valibot";import"zod";import"meilisearch";import"sanitize-html";import"@qwik-ui/utils";import"focus-trap";import"body-scroll-lock";import"country-list-json";import"node:child_process";import"@faker-js/faker/locale/cs_CZ";function w(e,t){var i;return((i=t==null?void 0:t.getOrigin)==null?void 0:i.call(t,e))??(t==null?void 0:t.origin)??process.env.ORIGIN??ee(e)}function ee(e){const{PROTOCOL_HEADER:t,HOST_HEADER:i}=process.env,d=e.headers,g=t&&d[t]||(e.socket.encrypted||e.connection.encrypted?"https":"http"),u=i??(e instanceof W?":authority":"host"),h=d[u];return`${g}://${h}`}function x(e,t){return oe(e.originalUrl||e.url||"/",t)}var te=/\/\/|\\\\/g;function oe(e,t){return new URL(e.replace(te,"/"),t)}async function ie(e,t,i,d,g){const u=new Headers,h=t.headers;for(const o in h){const r=h[o];if(typeof r=="string")u.set(o,r);else if(Array.isArray(r))for(const c of r)u.append(o,c)}const n=async function*(){for await(const o of t)yield o},s=t.method==="HEAD"||t.method==="GET"?void 0:n(),m=new AbortController,a={method:t.method,headers:u,body:s,signal:m.signal,duplex:"half"};return i.on("close",()=>{m.abort()}),{mode:d,url:e,request:new Request(e.href,a),env:{get(o){return process.env[o]}},getWritableStream:(o,r,c)=>{i.statusCode=o,r.forEach((b,f)=>i.setHeader(f,b));const v=c.headers();return v.length>0&&i.setHeader("Set-Cookie",v),new WritableStream({write(b){i.closed||i.destroyed||i.write(b,f=>{f&&console.error(f)})},close(){i.end()}})},getClientConn:()=>g?g(t):{ip:t.socket.remoteAddress},platform:{ssr:!0,incomingMessage:t,node:process.versions.node},locale:void 0}}var ae={"3gp":"video/3gpp","3gpp":"video/3gpp",asf:"video/x-ms-asf",asx:"video/x-ms-asf",avi:"video/x-msvideo",avif:"image/avif",bmp:"image/x-ms-bmp",css:"text/css",flv:"video/x-flv",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",jng:"image/x-jng",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",kar:"audio/midi",m4a:"audio/x-m4a",m4v:"video/x-m4v",mid:"audio/midi",midi:"audio/midi",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ogg:"audio/ogg",pdf:"application/pdf",png:"image/png",rar:"application/x-rar-compressed",shtml:"text/html",svg:"image/svg+xml",svgz:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",txt:"text/plain",wbmp:"image/vnd.wap.wbmp",webm:"video/webm",webp:"image/webp",wmv:"video/x-ms-wmv",woff:"font/woff",woff2:"font/woff2",xml:"text/xml",zip:"application/zip"};function re(){typeof global<"u"&&typeof globalThis.fetch!="function"&&typeof process<"u"&&process.versions.node&&(globalThis.fetch=q,globalThis.Headers=B,globalThis.Request=Q,globalThis.Response=X,globalThis.FormData=Y),typeof globalThis.TextEncoderStream>"u"&&(globalThis.TextEncoderStream=G,globalThis.TextDecoderStream=N),typeof globalThis.WritableStream>"u"&&(globalThis.WritableStream=I,globalThis.ReadableStream=M),typeof globalThis.crypto>"u"&&(globalThis.crypto=J.webcrypto)}function ne(e){var t;re();const i={_deserializeData:C,_serializeData:k,_verifySerializable:_};e.manifest&&P(e.manifest);const d=((t=e.static)==null?void 0:t.root)??y(L(import.meta.url),"..","..","dist");return{router:async(n,s,m)=>{try{const a=w(n,e),l=await ie(x(n,a),n,s,"server",e.getClientConn),o=await E(l,e,i);if(o){const r=await o.completion;if(r)throw r;if(o.requestEv.headersSent)return}m()}catch(a){console.error(a),m(a)}},notFound:async(n,s,m)=>{try{if(!s.headersSent){const a=w(n,e),l=x(n,a),o=F(l.pathname);s.writeHead(404,{"Content-Type":"text/html; charset=utf-8","X-Not-Found":l.pathname}),s.end(o)}}catch(a){console.error(a),m(a)}},staticFile:async(n,s,m)=>{var a;try{const l=w(n,e),o=x(n,l);if(z(n.method||"GET",o)){const r=o.pathname;let c;U(r).includes(".")?c=y(d,r):e.qwikCityPlan.trailingSlash?c=y(d,r+"index.html"):c=y(d,r,"index.html");const v=A(c),b=$(c).replace(/^\./,""),f=ae[b];f&&s.setHeader("Content-Type",f),(a=e.static)!=null&&a.cacheControl&&s.setHeader("Cache-Control",e.static.cacheControl),v.on("error",m),v.pipe(s);return}return m()}catch(l){console.error(l),m(l)}}}}const H=R(K(import.meta.url),"..","..","dist"),se=R(H,"build"),S=process.env.PORT??3e3,{router:me,notFound:le}=ne({render:D,qwikCityPlan:j,manifest:O,checkOrigin:!1}),p=T();p.use(V());p.use(Z("tiny"));p.use("/build",T.static(se,{immutable:!0,maxAge:"1y"}));p.use(T.static(H,{redirect:!1}));p.use(me);p.use(le);p.listen(S,async()=>{await new Promise(e=>setTimeout(e,500)),await import("./assets/meilisearch.config-1a95ed45.mjs"),console.log(`Server started: http://localhost:${S}/`)});
